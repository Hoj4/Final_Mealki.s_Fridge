<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.itwillbs.mappers.employeeMapper">
	<select id="userCheck" resultType="com.itwillbs.domain.EmployeeDTO">
        select * from employee
        where emp_num = #{emp_num} and emp_pass = #{emp_pass}
    </select>
    
    <select id="getEmployeeListMap" resultType="map">
    	select emp_num, emp_Kname, dept_position, dept_duty, department.dept_deptName, 
		DATE_FORMAT(emp_joinDate, '%Y-%m-%d')as emp_joinDate, 
	    concat(substring(concat('0',emp_tel) from 1 for 3),'-',substring(concat('0',emp_tel) from 4 for 3),'-',substring(concat('0',emp_tel) from 7 for 4)) as emp_tel, 
	    emp_email
		from employee join department
		on dept_num = dept_deptNum
		where 
			<if test="search_option == 'emp_Kname'.toString()">
				emp_Kname like CONCAT('%', #{keyword}, '%')
			</if>
			
			<if test="search_option == 'emp_num'.toString()">
				emp_num like CONCAT('%', #{keyword}, '%')
			</if>
			
			<if test="search_option == 'emp_tel'.toString()">
				emp_tel like CONCAT('%', #{keyword}, '%')
			</if>
			
			<if test="search_option == 'emp_phone'.toString()">
				emp_phone like CONCAT('%', #{keyword}, '%')
			</if>
			
			<if test="search_option == 'dept_num'.toString()">
				department.dept_deptName like CONCAT('%', #{keyword}, '%')
			</if>
			
		
		order by emp_joinDate desc
    </select>
    
<insert id="insertEmployee">
    insert into employee (
        emp_num, dept_num, emp_Kname, emp_Ename,
        emp_birth, emp_gender, emp_tel, emp_phone,
        emp_email, emp_addr, emp_addr2, emp_status,
        emp_classification, emp_joinDate,
        dept_position, dept_duty, emp_img, emp_numbering
    )
    select CONCAT(CAST(#{emp_classification} AS CHAR), DATE_FORMAT(#{emp_joinDate}, '%y%m%d'), LPAD((IFNULL(MAX(emp_numbering),0))+1,2,'0')),
           #{dept_num}, #{emp_Kname}, #{emp_Ename}, #{emp_birth}, #{emp_gender}, #{emp_tel}, #{emp_phone}, 
           #{emp_email}, #{emp_addr}, #{emp_addr2}, #{emp_status}, #{emp_classification},
           #{emp_joinDate}, #{dept_position}, #{dept_duty}, #{emp_img}, IFNULL(MAX(emp_numbering) + 1, 1)
    from employee
    where emp_joinDate = #{emp_joinDate} and emp_classification = #{emp_classification}
    LIMIT 1
</insert>




<!--  
SELECT CONCAT('3', DATE_FORMAT(NOW(), '%y%m%d'), LPAD((IFNULL(MAX(emp_numbering),0))+1,2,'0')),
           '200', '김어쩌구', 'kim', 950811, '남', '0550000000', '0100000000', 
           'aa@naver.com', '부산시', '어딘가', '재직중', '3',
           '2023-03-30', '팀원', '대리', 'emp_default.png',
           IFNULL(MAX(emp_numbering) + 1, 1)
FROM employee
WHERE emp_joinDate = DATE_FORMAT(NOW(), '%y%m%d') and emp_classification = '3'
LIMIT 1; -->


<!--  마지막 업로드 
    insert into employee (
        emp_num, dept_num, emp_Kname, emp_Ename,
        emp_birth, emp_gender, emp_tel, emp_phone,
        emp_email, emp_addr, emp_addr2, emp_status,
        emp_classification, emp_joinDate,
        dept_position, dept_duty, emp_img, emp_numbering
    )
    select CONCAT(#{emp_classification}, DATE_FORMAT(#{emp_joinDate}, '%y%m%d'), LPAD((IFNULL(MAX(emp_numbering),0))+1,2,'0')),
           #{dept_num}, #{emp_Kname}, #{emp_Ename}, #{emp_birth}, #{emp_gender}, #{emp_tel}, #{emp_phone}, 
           #{emp_email}, #{emp_addr}, #{emp_addr2}, #{emp_status}, #{emp_classification},
           #{emp_joinDate}, #{dept_position}, #{dept_duty}, #{emp_img}, IFNULL(MAX(emp_numbering) + 1, 1)
    from employee
    where emp_joinDate = #{emp_joinDate} and emp_classification = #{emp_classification}
    LIMIT 1

 -->
    
</mapper>