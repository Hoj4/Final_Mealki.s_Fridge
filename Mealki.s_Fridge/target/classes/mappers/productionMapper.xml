<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.itwillbs.mappers.productionMapper">
	<select id="ProductionList" resultType="com.itwillbs.domain.ProductionDTO">
<!--         select * from employee -->
<!--         where emp_num = #{emp_num} and emp_pass = #{emp_pass} -->
    </select>
    
    
<!--     	https://mybatis.org/mybatis-3/ -->
    <resultMap type="map" id="productionMap">
<!--    column="디비열이름" property="멤버변수이름" -->
<!--     	<id column="manu_num" property="manu_num"/> -->
    	<result column="wo_num" property="wo_num"/>
    	<result column="manu_name" property="manu_name"/>
    	<result column="item_name" property="item_name"/>
    	<result column="emp_Kname" property="emp_Kname"/>
    	<result column="manu_sdate" property="manu_sdate"/>
    	<result column="manu_date" property="manu_date"/>
    </resultMap>
    
    <select id="getProductionListMap" resultMap="productionMap">
    	select wo_num, manu_name, manu_code, item_name, item_num, manu_tocount, manu_fail, emp_Kname,
date_format(manu_date, '%Y-%m-%d %h:%i:%s') manu_date, date_format(manu_sdate, '%Y-%m-%d %h:%i:%s') 
as manu_sdate from productstatus
    	<where>
    		<if test="wo_num != null and !wo_num.equals('')">wo_num like CONCAT('%',#{wo_num},'%') </if>
			<if test="manu_name != null and !manu_name.equals('')">OR manu_name like CONCAT('%',#{manu_name},'%')</if>
			<if test="item_name != null and !item_name.equals('')">OR item_name like CONCAT('%',#{item_name},'%')</if>
			<if test="emp_Kname != null and !emp_Kname.equals('')">OR emp_Kname like CONCAT('%',#{emp_Kname},'%')</if>
			<if test="manu_date != null and !manu_date.equals('') and manu_sdate != null and !manu_sdate.equals('')">OR manu_date between date(#{manu_sdate}) and date(#{manu_date})+1</if>
    	</where>
    </select>
    
    <select id="getemp_Knamesession" resultType="com.itwillbs.domain.ProductionDTO">
			select distinct e.emp_num, e.emp_Kname
			from employee e where emp_num = #{emp_num}
    </select>
    
    <select id="getselectList" resultMap="productionMap">
    	select distinct w.manu_name, l.manu_code,w.wo_num, p.item_name, p.item_num 
from workorder w join products p
on w.item_name = p.item_name
join linecode l
on w.manu_name = l.manu_name;
    </select>
    
    <insert id="insertProduct">
    	insert into productstatus(manu_name, wo_num, item_name, manu_code, item_num, manu_tocount, manu_fail, emp_Kname, manu_date, manu_sdate) 
    	values(#{manu_name},#{wo_num},#{item_name},#{manu_code},#{item_num},#{manu_tocount},#{manu_fail},#{emp_Kname},DATE_FORMAT(now(), '%Y%m%d%H%i%s'),DATE_FORMAT(now(), '%Y%m%d%H%i%s'))
    </insert>

</mapper>